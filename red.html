<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç´…å¸½ï¼šæ·±å½åµæ¸¬å”å®š</title>
    <style>
        body {
            font-family: "Courier New", monospace;
            background-color: #0d0d0d;
            color: #0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden; /* é˜²æ­¢æ°´å¹³å·è»¸ */
        }

        /* å¾©å¤ CRT è¢å¹•æ•ˆæœ */
        .screen-container {
            width: 90%;
            max-width: 600px;
            border: 2px solid #333;
            background: #001a00;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            position: relative;
        }
        
        /* æƒæç·šç‰¹æ•ˆ */
        .screen-container::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        h1 { margin: 0 0 20px 0; font-size: 1.2rem; text-shadow: 0 0 5px #0f0; }
        
        /* å°è©±å€ */
        .dialogue-box {
            height: 150px;
            border: 1px solid #004d00;
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 20px;
            background: #000;
            font-size: 1rem;
            line-height: 1.5;
            color: #fff;
        }

        .wolf-text { color: #ff4d4d; } /* ç‹¼çš„å­—æ˜¯ç´…è‰²çš„ */
        .system-text { color: #0f0; font-style: italic; }

        /* æ¸¬è¬Šå„€é¡¯ç¤ºå™¨ */
        .monitor-box {
            position: relative;
            background: #000;
            border: 1px solid #004d00;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            overflow: hidden;
        }

        canvas { width: 100%; height: 100%; }

        /* ç‹€æ…‹æ•¸æ“š */
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        /* æ“æ§æŒ‰éˆ• */
        .btn-action {
            width: 100%;
            padding: 15px;
            background: #003300;
            color: #0f0;
            border: 1px solid #0f0;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.1s;
        }

        .btn-action:active { background: #0f0; color: #000; }
        .btn-action:disabled { background: #111; color: #555; border-color: #333; cursor: not-allowed; }

        /* å›é¦–é æŒ‰éˆ• (å³ä¸‹è§’æ‡¸æµ®) */
        .home-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background: rgba(0, 50, 0, 0.8);
            border: 1px solid #0f0;
            color: #0f0;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9rem;
            z-index: 50;
            transition: all 0.3s;
        }
        .home-btn:hover {
            background: #0f0;
            color: #000;
        }

        /* çµæœé€šçŸ¥ */
        .alert {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #0f0;
            text-align: center;
            z-index: 10;
            display: none;
            width: 80%;
            max-width: 400px;
        }

        /* æŠ–å‹•ç‰¹æ•ˆ */
        .glitch { animation: glitch-anim 0.3s infinite; }
        @keyframes glitch-anim {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }
    </style>
</head>
<body>

<div class="screen-container">
    <h1>VOICE_ANALYSIS_PROTOCOL // v2.0</h1>
    
    <div class="status-bar">
        <span>INTEGRITY(ä¿¡ç”¨å€¼): <span id="hp-val">100%</span></span>
        <span>TARGET_STRESS(å°æ–¹å£“åŠ›): <span id="stress-val">0%</span></span>
    </div>

    <div class="monitor-box" id="monitor">
        <canvas id="waveCanvas"></canvas>
    </div>

    <div class="dialogue-box" id="chat-box">
        <div class="system-text">> ç³»çµ±é€£ç·šæˆåŠŸ...</div>
        <div class="system-text">> éŸ³è¨Šä¸²æµåˆ†æå•Ÿå‹•...</div>
        <div class="system-text">> ç­‰å¾…èªéŸ³è¼¸å…¥...</div>
    </div>

    <button class="btn-action" id="btn-doubt" onclick="checkLie()">ğŸš¨ æ¨™è¨˜ç•°å¸¸ (SPACE)</button>
</div>

<a href="index.html" class="home-btn">[ HOME ]</a>

<div id="end-screen" class="alert">
    <h2 id="end-title"></h2>
    <p id="end-desc"></p>
    <div style="margin-top: 20px;">
        <button class="btn-action" onclick="location.reload()" style="font-size:1rem; padding:10px; margin-bottom:10px;">REBOOT SYSTEM</button>
        <button class="btn-action" onclick="location.href='index.html'" style="font-size:1rem; padding:10px;">RETURN HOME</button>
    </div>
</div>

<script>
    // --- éŠæˆ²è®Šæ•¸ ---
    let hp = 100;
    let stress = 0; // é”åˆ° 100 ç‹¼å°±æœƒå´©æ½°(å‹åˆ©)
    let isSpeaking = false;
    let isLying = false; // ç›®å‰æ˜¯å¦æ­£åœ¨èªªè¬Š(è¨Šè™Ÿç•°å¸¸)
    let currentDialogueIndex = 0;
    
    // ç•«å¸ƒè¨­å®š
    const canvas = document.getElementById('waveCanvas');
    const ctx = canvas.getContext('2d');
    let time = 0;
    let amplitude = 10;
    let frequency = 0.05;
    let waveColor = '#0f0';

    // å°è©±è…³æœ¬ (text: æ–‡å­—, duration: èªªè©±æ™‚é–“, lies: [è¬Šè¨€é–‹å§‹ç§’æ•¸, è¬Šè¨€çµæŸç§’æ•¸])
    const script = [
        { text: "å°ç´…å¸½...å¿«é€²ä¾†...é–€æ²’é–...", duration: 3000, lies: [[0.5, 1.5]] }, // "å¿«é€²ä¾†"æ˜¯è¬Šè©±
        { text: "å¥¶å¥¶åªæ˜¯...æ„Ÿå†’äº†ï¼Œè²éŸ³æ‰é€™éº¼ä½æ²‰ã€‚", duration: 4000, lies: [[1.5, 2.5]] }, // "æ„Ÿå†’"æ˜¯è¬Šè©±
        { text: "è€³æœµå¤§æ˜¯ç‚ºäº†...è½æ¸…æ¥šå¦³çš„è²éŸ³å•Šã€‚", duration: 3500, lies: [] }, // é€™æ˜¯å¯¦è©±/æ•·è¡ï¼Œç„¡ç•°å¸¸
        { text: "çœ¼ç›å¤§æ˜¯ç‚ºäº†...çœ‹æ¸…æ¥šå¦³å¯æ„›çš„è‡‰ã€‚", duration: 3500, lies: [] }, // é€™æ˜¯å¯¦è©±
        { text: "ç‰™é½’å°–æ˜¯å› ç‚º...æˆ‘å‰›è£äº†å‡ç‰™ï¼", duration: 3000, lies: [[1.8, 2.8]] }, // "å‡ç‰™"æ˜¯è¶…å¤§è¬Šè¨€
        { text: "éä¾†...è®“å¥¶å¥¶æŠ±æŠ±å¦³...", duration: 5000, lies: [[0.5, 4.5]] } // æ•´å¥éƒ½æ˜¯å±éšªè¬Šè¨€
    ];

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šæ³¢å½¢ç¹ªè£½ (Oscilloscope) ---
    function drawWave() {
        // è¨­å®š Canvas å¤§å°
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = canvas.parentElement.clientHeight;
        const centerY = canvas.height / 2;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.strokeStyle = waveColor;
        ctx.lineWidth = 2;

        for (let x = 0; x < canvas.width; x++) {
            // å¦‚æœæ­£åœ¨èªªè¬Šï¼Œæ³¢å½¢æœƒè®Šå¾—æ··äº‚
            let localAmp = amplitude;
            let localFreq = frequency;
            
            if (isLying) {
                // æ¨¡æ“¬é›œè¨Š (Noise)
                localAmp = 40 + Math.random() * 20;
                localFreq = 0.2;
                ctx.lineWidth = 3;
            } else if (!isSpeaking) {
                // éœéŸ³ç‹€æ…‹
                localAmp = 2;
            }

            const y = centerY + Math.sin(x * localFreq + time) * localAmp;
            ctx.lineTo(x, y);
        }
        ctx.stroke();
        time += 0.2;
        requestAnimationFrame(drawWave);
    }

    // --- éŠæˆ²é‚è¼¯ ---
    function nextLine() {
        if (currentDialogueIndex >= script.length) {
            endGame(true); // å°è©±çµæŸé‚„æ´»è‘— = å‹åˆ©
            return;
        }

        const line = script[currentDialogueIndex];
        const chatBox = document.getElementById('chat-box');
        
        // é¡¯ç¤ºæ–‡å­—
        const div = document.createElement('div');
        div.className = 'wolf-text';
        div.innerText = `[AUDIO]: "${line.text}"`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;

        // é–‹å§‹æ¨¡æ“¬èªéŸ³
        isSpeaking = true;
        let startTime = Date.now();

        // ç›£æ§è¬Šè¨€æ™‚é–“å€é–“
        const lieCheckInterval = setInterval(() => {
            let elapsed = (Date.now() - startTime) / 1000;
            
            // æª¢æŸ¥ç¾åœ¨æ˜¯å¦åœ¨è¬Šè¨€å€é–“å…§
            let inLieZone = false;
            for (let range of line.lies) {
                if (elapsed >= range[0] && elapsed <= range[1]) {
                    inLieZone = true;
                    break;
                }
            }

            if (inLieZone) {
                triggerLieMode(true);
            } else {
                triggerLieMode(false);
            }

            // èªªè©±çµæŸ
            if (elapsed * 1000 > line.duration) {
                clearInterval(lieCheckInterval);
                isSpeaking = false;
                triggerLieMode(false); // ç¢ºä¿æ³¢å½¢æ­¸é›¶
                
                // é€²å…¥ä¸‹ä¸€å¥å‰çš„å»¶é²
                setTimeout(nextLine, 2000);
            }
        }, 100);

        currentDialogueIndex++;
    }

    function triggerLieMode(active) {
        if (active) {
            isLying = true;
            waveColor = '#ff0000'; // è®Šç´…
            document.getElementById('monitor').classList.add('glitch'); // ç•«é¢æŠ–å‹•
        } else {
            isLying = false;
            waveColor = '#0f0'; // è®Šç¶ 
            document.getElementById('monitor').classList.remove('glitch');
        }
    }

    // --- ç©å®¶äº’å‹• ---
    function checkLie() {
        if (hp <= 0) return;

        const btn = document.getElementById('btn-doubt');
        
        // è¦–è¦ºå›é¥‹
        btn.style.background = '#fff';
        setTimeout(() => btn.style.background = '', 100);

        if (isLying) {
            // æŠ“åˆ°äº†ï¼
            stress += 20;
            showMessage("âœ… ç•°å¸¸è¨Šè™Ÿæ•ç²ï¼(SUCCESS)");
            document.getElementById('stress-val').innerText = stress + "%";
            
            // ç‹¼å—åˆ°å¹²æ“¾ï¼Œè¬Šè¨€ä¸­æ–·
            triggerLieMode(false); 
        } else {
            // èª¤åˆ¤ï¼
            hp -= 20;
            showMessage("âŒ èª¤åˆ¤æ­£å¸¸è¨Šè™Ÿï¼(FALSE POSITIVE)");
            document.getElementById('hp-val').innerText = hp + "%";
            document.getElementById('hp-val').style.color = '#ff0000';
        }

        checkStatus();
    }

    function showMessage(msg) {
        const chatBox = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = 'system-text';
        div.innerText = `> ${msg}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function checkStatus() {
        if (hp <= 0) {
            endGame(false);
        }
        if (stress >= 100) {
            endGame(true);
        }
    }

    function endGame(win) {
        isSpeaking = false;
        isLying = false;
        const screen = document.getElementById('end-screen');
        const title = document.getElementById('end-title');
        const desc = document.getElementById('end-desc');
        
        screen.style.display = 'block';

        if (win) {
            title.innerText = "åµæ¸¬æˆåŠŸï¼šèº«åˆ†ç¢ºèª";
            title.style.color = "#0f0";
            desc.innerText = "å¦³æˆåŠŸè¾¨è­˜äº† Deepfake èªéŸ³ç‰¹å¾µã€‚ç›®æ¨™ï¼ˆå¤§é‡ç‹¼ï¼‰å› å£“åŠ›éå¤§è€Œéœ²å‡ºé¦¬è…³ã€‚å¦³å•Ÿå‹•äº†ç·Šæ€¥é˜²ç¦¦ç³»çµ±ä¸¦æˆåŠŸé€ƒè„«ã€‚";
        } else {
            title.innerText = "ç³»çµ±å´©æ½°ï¼šé­åˆ°å…¥ä¾µ";
            title.style.color = "#f00";
            desc.innerText = "ä¿¡ç”¨å€¼æ­¸é›¶ã€‚å¦³æœªèƒ½åŠæ™‚åˆ†è¾¨çœŸå½ï¼Œæˆ–è€…ç”¢ç”Ÿäº†å¤ªå¤šæ¬¡èª¤åˆ¤ã€‚å¤§é‡ç‹¼æˆåŠŸé¨™éäº†å¦³çš„é˜²ç«ç‰†...";
        }
    }

    // æ”¯æ´éµç›¤æ“ä½œ
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            checkLie();
        }
    });

    // å•Ÿå‹•å‹•ç•«èˆ‡éŠæˆ²
    drawWave();
    setTimeout(nextLine, 1000); // 1ç§’å¾Œé–‹å§‹ç¬¬ä¸€å¥

</script>
</body>
</html>
