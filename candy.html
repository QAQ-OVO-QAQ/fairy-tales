<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³–æœå±‹ï¼šé­”å¥³è¿½æ“Šæˆ°</title>
    <style>
        body {
            font-family: "Courier New", monospace;
            background-color: #050505;
            color: #ddd;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
            overflow: hidden;
        }

        /* è­¦å ±é–ƒçˆç‰¹æ•ˆ */
        @keyframes alarm {
            0% { box-shadow: 0 0 0 transparent; }
            50% { box-shadow: 0 0 50px rgba(255, 0, 0, 0.3) inset; }
            100% { box-shadow: 0 0 0 transparent; }
        }
        .danger-mode { animation: alarm 1s infinite; width: 100%; height: 100%; position: absolute; pointer-events: none; z-index: 0; }

        h1 { color: #e74c3c; margin-bottom: 5px; text-shadow: 0 0 10px #c0392b; z-index: 1; }
        p.subtitle { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 20px; z-index: 1; }

        .status-bar {
            display: flex;
            gap: 20px;
            background: #222;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #444;
            z-index: 1;
        }

        .stat-item { font-size: 1.1rem; font-weight: bold; }
        
        .grid-container {
            display: grid;
            grid-template-columns: repeat(6, 50px); /* åŠ å¤§åˆ° 6x6 */
            grid-template-rows: repeat(6, 50px);
            gap: 4px;
            background: #111;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            position: relative;
            z-index: 1;
        }

        .cell {
            width: 50px; height: 50px;
            background-color: #2c3e50;
            border-radius: 4px;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.8rem; cursor: pointer;
            position: relative;
        }

        .cell.fog { background-color: #000 !important; color: transparent !important; cursor: default; border: 1px solid #111; }
        .cell.player { background-color: #3498db; box-shadow: 0 0 15px #3498db; z-index: 10; }
        .cell.witch { background-color: #c0392b; animation: pulse 0.8s infinite; z-index: 9; }
        .cell.bread { font-size: 1.2rem; }
        .cell.stone { border: 2px solid #fff; font-size: 1.2rem; }
        .cell.goal { background-color: #f1c40f; }
        .cell.start { background-color: #27ae60; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .controls { margin-top: 20px; text-align: center; z-index: 1; }
        .btn-action { padding: 10px 20px; font-size: 1rem; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-stone { background: #95a5a6; color: #000; }
        .btn-bread { background: #e67e22; color: white; }

        /* è¨Šæ¯å€ */
        .log-box {
            margin-top: 15px; height: 80px; width: 320px;
            background: rgba(0,0,0,0.8); color: #2ecc71;
            padding: 10px; font-size: 0.8rem; overflow-y: hidden;
            border: 1px solid #333; font-family: monospace; z-index: 1;
        }

        /* çµå±€é®ç½© */
        .overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 20;
            flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        .overlay h2 { font-size: 2rem; margin-bottom: 20px; }
        .overlay p { max-width: 500px; line-height: 1.6; color: #aaa; margin-bottom: 30px; }
    </style>
</head>
<body>

    <div id="danger-bg"></div>

    <h1>é­”å¥³è¿½æ“Šæˆ° (v2.0)</h1>
    <p class="subtitle">ä»»å‹™ï¼šåˆ©ç”¨éºµåŒ…ç•¶èª˜é¤Œï¼Œæ‹¿åˆ°é‘°åŒ™ä¸¦æ´»è‘—é€ƒé›¢</p>

    <div class="status-bar">
        <div class="stat-item" style="color:#bdc3c7">ğŸª¨ çŸ³é ­: <span id="stone-val">2</span></div>
        <div class="stat-item" style="color:#e67e22">ğŸ éºµåŒ…: <span id="bread-val">15</span></div>
    </div>

    <div class="grid-container" id="grid"></div>

    <div class="controls">
        ç•¶å‰é“å…·ï¼š<strong id="current-tool" style="color: #e67e22;">ğŸ éºµåŒ… (å¯èª˜æ•µ)</strong><br>
        <button class="btn-action btn-bread" onclick="setTool('bread')">ç”¨éºµåŒ…</button>
        <button class="btn-action btn-stone" onclick="setTool('stone')">ç”¨çŸ³é ­</button>
    </div>

    <div class="log-box" id="game-log">> ç³»çµ±å•Ÿå‹•...<br>> è­¦å‘Šï¼šåµæ¸¬åˆ°æƒ¡æ„ç¨‹å¼(é­”å¥³)é è¿‘...</div>

    <div id="end-screen" class="overlay">
        <h2 id="end-title"></h2>
        <p id="end-desc"></p>
        <div style="background:#222; padding:15px; border-left:4px solid #f1c40f; text-align:left; font-size:0.9rem;">
            <strong>ã€åœ–æ›¸è³‡è¨Šéš±å–»ã€‘</strong><br>
            é€™æ¨¡æ“¬äº†ã€Œç¶²è·¯çˆ¬èŸ²ã€æˆ–ã€Œæƒ¡æ„è»Ÿé«”ã€çš„æ”»æ“Šã€‚åœ¨è³‡è¨Šå®‰å…¨èˆ‡ä¿å­˜ä¸­ï¼Œæˆ‘å€‘ä¸åƒ…è¦é¢å°è‡ªç„¶çš„è³‡æ–™æµå¤±ï¼ˆBit Rotï¼‰ï¼Œé‚„è¦é¢å°ä¸»å‹•çš„ç ´å£è€…ã€‚éºµåŒ…å±‘åœ¨æ­¤è™•è±¡å¾µã€Œèœœç½ (Honeypot)ã€æŠ€è¡“ï¼Œç”¨å‡è³‡æ–™ä¾†èª˜é¨™ä¸¦æ‹–å»¶æ”»æ“Šè€…ã€‚
        </div>
        <br>
        <button class="btn-action btn-bread" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
    </div>

<script>
    // --- åƒæ•¸è¨­å®š ---
    const gridSize = 6;
    let player = { x: 0, y: 0 };
    let witch = { x: 5, y: 5 }; // é­”å¥³å¾å°è§’ç·šå‡ºä¾†
    let goal = { x: 5, y: 5, taken: false };
    
    let stones = 2;
    let breads = 15;
    let currentTool = 'bread';
    let gridData = [];
    let turnCount = 0;
    let isGameOver = false;

    const logBox = document.getElementById('game-log');
    
    function init() {
        const gridEl = document.getElementById('grid');
        gridEl.innerHTML = '';
        gridData = [];

        for (let y = 0; y < gridSize; y++) {
            let row = [];
            for (let x = 0; x < gridSize; x++) {
                let cell = document.createElement('div');
                cell.className = 'cell fog';
                cell.onclick = () => movePlayer(x, y);
                gridEl.appendChild(cell);
                row.push({ el: cell, visited: false, content: null });
            }
            gridData.push(row);
        }

        // è¨­å®šèµ·é»
        gridData[0][0].visited = true;
        render();
    }

    function movePlayer(x, y) {
        if (isGameOver) return;

        // æª¢æŸ¥ç§»å‹•åˆæ³•æ€§ (åªèƒ½èµ°é„°è¿‘ 1 æ ¼)
        if (Math.abs(x - player.x) + Math.abs(y - player.y) !== 1) return;

        // è³‡æºæª¢æŸ¥èˆ‡æ”¾ç½®
        if (!gridData[y][x].visited) {
            if (currentTool === 'stone') {
                if (stones > 0) { stones--; gridData[y][x].content = 'stone'; }
                else { log("âŒ çŸ³é ­æ²’äº†ï¼"); return; }
            } else {
                if (breads > 0) { breads--; gridData[y][x].content = 'bread'; }
                else { log("âŒ éºµåŒ…æ²’äº†ï¼"); return; }
            }
            gridData[y][x].visited = true;
        }

        // ç§»å‹•ç©å®¶
        player = { x, y };
        turnCount++;
        
        // æª¢æŸ¥äº‹ä»¶
        checkEvents();
        
        // é­”å¥³å›åˆ
        if (!isGameOver) moveWitch();
        
        updateUI();
        render();
    }

    function moveWitch() {
        // é­”å¥³è¿½è¹¤æ¼”ç®—æ³•
        let dx = player.x - witch.x;
        let dy = player.y - witch.y;
        
        let moveX = witch.x;
        let moveY = witch.y;

        // ç°¡å–® AIï¼šèª°é èµ°èª°
        if (Math.abs(dx) > Math.abs(dy)) {
            moveX += (dx > 0 ? 1 : -1);
        } else {
            moveY += (dy > 0 ? 1 : -1);
        }

        // æª¢æŸ¥é­”å¥³è¸©åˆ°çš„æ ¼å­
        let targetCell = gridData[moveY][moveX];

        if (targetCell.content === 'bread') {
            log("ğŸ é­”å¥³æ­£åœ¨åƒéºµåŒ…ï¼Œæš«åœä¸€å›åˆï¼");
            targetCell.content = null; // éºµåŒ…è¢«åƒæ‰
            targetCell.el.innerText = ''; 
            // é­”å¥³é€™å›åˆä¸ç§»å‹•
        } else if (targetCell.content === 'stone') {
            log("ğŸª¨ é­”å¥³è¢«çŸ³é ­æ“‹äº†ä¸€ä¸‹ï¼Œç§»å‹•ç·©æ…¢ã€‚");
            witch.x = moveX;
            witch.y = moveY;
        } else {
            // æ­£å¸¸ç§»å‹•
            witch.x = moveX;
            witch.y = moveY;
        }

        // æª¢æŸ¥æ˜¯å¦æŠ“åˆ°ç©å®¶
        if (witch.x === player.x && witch.y === player.y) {
            endGame(false);
        }
    }

    function checkEvents() {
        // æ‹¿åˆ°é‘°åŒ™
        if (player.x === goal.x && player.y === goal.y && !goal.taken) {
            goal.taken = true;
            log("ğŸ”‘ æ‹¿åˆ°é‘°åŒ™äº†ï¼å¿«è·‘å›èµ·é»ï¼");
            document.querySelector('.subtitle').innerText = "âš ï¸ è­¦å ±ï¼šé­”å¥³è¢«æ¿€æ€’äº†ï¼å¿«é€ƒå›èµ·é»(0,0)ï¼";
            document.querySelector('.subtitle').style.color = "#e74c3c";
            document.getElementById('danger-bg').className = 'danger-mode'; // é–‹å•Ÿç´…å…‰ç‰¹æ•ˆ
        }

        // å›åˆ°èµ·é»
        if (player.x === 0 && player.y === 0 && goal.taken) {
            endGame(true);
        }
    }

    function render() {
        for (let y = 0; y < gridSize; y++) {
            for (let x = 0; x < gridSize; x++) {
                const cell = gridData[y][x];
                const el = cell.el;
                
                // æ¸…ç©ºæ¨£å¼
                el.className = 'cell';
                el.innerText = '';

                // è¿·éœ§ç³»çµ± (å¯è¦‹è·é›¢ 2 æ ¼)
                const dist = Math.abs(x - player.x) + Math.abs(y - player.y);
                if (dist > 2 && !cell.visited && !(x===goal.x && y===goal.y)) {
                    el.classList.add('fog');
                    continue;
                }

                // ç¹ªè£½ç‰©ä»¶
                if (x === player.x && y === player.y) {
                    el.classList.add('player');
                    el.innerText = 'ğŸ§’';
                } else if (x === witch.x && y === witch.y) {
                    el.classList.add('witch');
                    el.innerText = 'ğŸ‘º';
                } else if (x === goal.x && y === goal.y && !goal.taken) {
                    el.classList.add('goal');
                    el.innerText = 'ğŸ”‘';
                } else if (x === 0 && y === 0) {
                    el.classList.add('start');
                    el.innerText = 'ğŸ ';
                } else if (cell.content === 'stone') {
                    el.classList.add('stone');
                    el.innerText = 'ğŸª¨';
                } else if (cell.content === 'bread') {
                    el.classList.add('bread');
                    el.innerText = 'ğŸ';
                }
            }
        }
    }

    function endGame(win) {
        isGameOver = true;
        const screen = document.getElementById('end-screen');
        const title = document.getElementById('end-title');
        const desc = document.getElementById('end-desc');
        
        screen.style.display = 'flex';
        document.getElementById('danger-bg').className = '';

        if (win) {
            title.innerText = "ğŸ‰ é€ƒè„«æˆåŠŸ";
            title.style.color = "#2ecc71";
            desc.innerText = "ä½ æˆåŠŸåˆ©ç”¨éºµåŒ…èª˜é¨™äº†æƒ¡æ„ç¨‹å¼ï¼Œä¿ä½äº†æ ¸å¿ƒè³‡æ–™ï¼ˆé‘°åŒ™ï¼‰ä¸¦å®‰å…¨æ’¤é›¢ã€‚é€™æ˜¯ä¸€æ¬¡å®Œç¾çš„è³‡è¨Šé˜²ç¦¦è¡Œå‹•ã€‚";
        } else {
            title.innerText = "ğŸ’€ è³‡æ–™è¢«åå™¬";
            title.style.color = "#c0392b";
            desc.innerText = "é­”å¥³æŠ“ä½äº†ä½ ã€‚æ‰€æœ‰çš„è·¯å¾‘è³‡æ–™éƒ½è¢«æƒ¡æ„ç¨‹å¼è¦†è“‹ï¼Œä½ è¿·å¤±åœ¨é›œäº‚çš„ä½å…ƒæ´ªæµä¸­...";
        }
    }

    function setTool(t) { currentTool = t; updateUI(); }
    function updateUI() {
        document.getElementById('stone-val').innerText = stones;
        document.getElementById('bread-val').innerText = breads;
        document.getElementById('current-tool').innerText = currentTool === 'stone' ? 'ğŸª¨ çŸ³é ­' : 'ğŸ éºµåŒ… (å¯èª˜æ•µ)';
    }
    function log(msg) {
        logBox.innerHTML = `> ${msg}<br>` + logBox.innerHTML;
    }

    init();

</script>
</body>
</html>
